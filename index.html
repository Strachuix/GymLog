<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121212">
    <meta name="description" content="Śledź swoje treningi i postępy w siłowni">
    <link rel="manifest" href="manifest.json">
    <title>GymLog - Trening</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neon-green': '#10b981',
                        'dark-bg': '#121212',
                        'dark-card': '#1e1e1e',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.8); }
        }
        .pulse-glow { animation: pulse-glow 2s infinite; }
    </style>
</head>
<body class="bg-dark-bg text-gray-100 min-h-screen pb-20">
    <div class="max-w-lg mx-auto p-4 sm:p-6">
        <!-- Header with Wake Lock Indicator -->
        <header class="flex items-center justify-between mb-8 pt-4">
            <div class="flex items-center gap-3">
                <img src="logo.png" alt="GymLog" class="h-10 w-auto">
            </div>
            <button id="wakeLockIndicator" onclick="toggleWakeLock()" class="flex items-center gap-2 bg-dark-card px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors" title="Kliknij aby włączyć/wyłączyć blokadę ekranu">
                <div id="wakeLockDot" class="w-2 h-2 bg-gray-600 rounded-full"></div>
                <svg id="wakeLockIcon" class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path id="wakeLockIconPath" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
            </button>
        </header>

        <!-- Training Form -->
        <main>
            <form id="trainingForm" class="space-y-5">
                <!-- Exercise Name -->
                <div>
                    <label for="exercise" class="block text-sm font-bold text-gray-400 uppercase tracking-wide mb-2">
                        Ćwiczenie
                    </label>
                    <input 
                        type="text" 
                        id="exercise" 
                        list="exerciseHistory"
                        required
                        class="w-full bg-dark-card border-2 border-gray-700 rounded-2xl py-4 px-5 text-xl font-semibold focus:border-neon-green focus:outline-none transition-all placeholder:text-gray-600 text-gray-100"
                        placeholder="np. Wyciskanie sztangi"
                    >
                    <datalist id="exerciseHistory"></datalist>
                </div>

                <!-- Weight and Reps Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="weight" class="block text-sm font-bold text-gray-400 uppercase tracking-wide mb-2">
                            Ciężar (kg)
                        </label>
                        <input 
                            type="number" 
                            id="weight" 
                            step="0.5"
                            required
                            inputmode="decimal"
                            class="w-full bg-dark-card border-2 border-gray-700 rounded-2xl py-4 px-4 text-2xl font-black focus:border-neon-green focus:outline-none transition-all placeholder:text-gray-700 text-center text-neon-green"
                            placeholder="0"
                        >
                    </div>
                    <div>
                        <label for="reps" class="block text-sm font-bold text-gray-400 uppercase tracking-wide mb-2">
                            Powtórzenia
                        </label>
                        <input 
                            type="number" 
                            id="reps" 
                            min="1"
                            required
                            inputmode="numeric"
                            class="w-full bg-dark-card border-2 border-gray-700 rounded-2xl py-4 px-4 text-2xl font-black focus:border-neon-green focus:outline-none transition-all placeholder:text-gray-700 text-center text-gray-100"
                            placeholder="0"
                        >
                    </div>
                </div>

                <!-- Suggestion Box -->
                <div id="suggestionBox" class="hidden bg-neon-green/10 border-2 border-neon-green/30 rounded-2xl p-4 animate-slide-in">
                    <div class="flex items-center gap-3">
                        <div class="bg-neon-green p-2 rounded-lg">
                            <svg class="w-5 h-5 text-dark-bg" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-neon-green uppercase tracking-wider">Progresja!</p>
                            <p id="suggestionText" class="text-white font-semibold text-sm"></p>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit"
                    class="w-full bg-neon-green hover:bg-emerald-400 active:scale-98 text-dark-bg font-black text-xl py-5 rounded-2xl shadow-lg shadow-neon-green/30 transition-all flex items-center justify-center gap-3 pulse-glow"
                >
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
                    </svg>
                    DODAJ SERIĘ
                </button>
            </form>

            <!-- Recent Sets -->
            <section class="mt-8">
                <h2 class="text-lg font-bold text-gray-400 uppercase tracking-wide mb-4">Ostatnie 5 serii</h2>
                <div id="recentSets" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </section>
        </main>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-dark-card border-t border-gray-800 z-50">
        <div class="max-w-lg mx-auto flex">
            <a href="index.html" class="flex-1 flex flex-col items-center justify-center py-4 text-neon-green">
                <svg class="w-7 h-7 mb-1" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C10.9 2 10 2.9 10 4C10 5.1 10.9 6 12 6C13.1 6 14 5.1 14 4C14 2.9 13.1 2 12 2M16.5 9.5C15.67 9.5 15 10.17 15 11C15 11.83 15.67 12.5 16.5 12.5S18 11.83 18 11 17.33 9.5 16.5 9.5M7.5 9.5C6.67 9.5 6 10.17 6 11S6.67 12.5 7.5 12.5 9 11.83 9 11 8.33 9.5 7.5 9.5M14.97 11.5C14.87 10.87 14.5 10.29 14 9.83C13.5 9.38 12.78 9 12 9C11.22 9 10.5 9.38 10 9.83C9.5 10.29 9.13 10.87 9.03 11.5H7.5C7.5 11.5 6 11 6 13.5V17C6 17.5 6.45 18 7 18C7.55 18 8 17.5 8 17V14H9V21C9 21.5 9.45 22 10 22C10.55 22 11 21.5 11 21V15H13V21C13 21.5 13.45 22 14 22C14.55 22 15 21.5 15 21V14H16V17C16 17.5 16.45 18 17 18C17.55 18 18 17.5 18 17V13.5C18 11 16.5 11.5 16.5 11.5H14.97Z"/>
                </svg>
                <span class="text-xs font-bold">TRENING</span>
            </a>
            <a href="stats.html" class="flex-1 flex flex-col items-center justify-center py-4 text-gray-500 hover:text-gray-400 transition-colors">
                <svg class="w-7 h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <span class="text-xs font-bold">STATYSTYKI</span>
            </a>
        </div>
    </nav>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed top-6 left-1/2 -translate-x-1/2 bg-neon-green text-dark-bg px-6 py-3 rounded-full font-bold shadow-2xl z-50 animate-slide-in">
        ✓ Seria zapisana!
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('Service Worker registered', reg))
                .catch(err => console.error('Service Worker error', err));
        }

        // Screen Wake Lock API
        let wakeLock = null;
        let wakeLockEnabled = false;
        
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLockEnabled = true;
                    updateWakeLockUI(true);
                    
                    wakeLock.addEventListener('release', () => {
                        wakeLockEnabled = false;
                        updateWakeLockUI(false);
                    });
                }
            } catch (err) {
                console.error('Wake Lock error:', err);
                wakeLockEnabled = false;
                updateWakeLockUI(false);
            }
        }
        
        async function releaseWakeLock() {
            if (wakeLock !== null) {
                await wakeLock.release();
                wakeLock = null;
                wakeLockEnabled = false;
                updateWakeLockUI(false);
            }
        }
        
        async function toggleWakeLock() {
            if (wakeLockEnabled) {
                await releaseWakeLock();
            } else {
                await requestWakeLock();
            }
        }
        
        function updateWakeLockUI(active) {
            const dot = document.getElementById('wakeLockDot');
            const icon = document.getElementById('wakeLockIcon');
            const iconPath = document.getElementById('wakeLockIconPath');
            
            if (active) {
                // Aktywny - zielony z pulsowaniem
                dot.className = 'w-2 h-2 bg-neon-green rounded-full animate-pulse';
                icon.className = 'w-4 h-4 text-neon-green';
                iconPath.setAttribute('d', 'M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z');
            } else {
                // Nieaktywny - szary, ikona otwartej kłódki
                dot.className = 'w-2 h-2 bg-gray-600 rounded-full';
                icon.className = 'w-4 h-4 text-gray-600';
                iconPath.setAttribute('d', 'M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z');
            }
        }
        
        document.addEventListener('visibilitychange', async () => {
            if (wakeLockEnabled && document.visibilityState === 'visible') {
                await requestWakeLock();
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            updateWakeLockUI(false);  // Pokaż jako nieaktywny
            loadExerciseHistory();
            displayRecentSets();
            
            // Form submission
            document.getElementById('trainingForm').addEventListener('submit', handleFormSubmit);
            
            // Listen for input changes to show suggestions
            document.getElementById('exercise').addEventListener('input', checkSuggestion);
            document.getElementById('reps').addEventListener('input', checkSuggestion);
        });

        // Load exercise history into datalist
        function loadExerciseHistory() {
            const exercises = getExerciseHistory();
            const datalist = document.getElementById('exerciseHistory');
            datalist.innerHTML = exercises.map(ex => `<option value="${ex}">`).join('');
        }

        // Display recent 5 sets
        function displayRecentSets() {
            const sets = loadSets().slice(0, 5);
            const container = document.getElementById('recentSets');
            
            if (sets.length === 0) {
                container.innerHTML = `
                    <div class="bg-dark-card border-2 border-dashed border-gray-800 rounded-2xl p-8 text-center">
                        <p class="text-gray-600 font-medium">Brak historii. Dodaj pierwszą serię!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = sets.map(set => `
                <div class="bg-dark-card border border-gray-800 rounded-xl p-4 flex items-center justify-between hover:border-gray-700 transition-colors">
                    <div>
                        <p class="font-bold text-lg">${set.exercise}</p>
                        <p class="text-xs text-gray-500">${new Date(set.timestamp).toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' })}</p>
                    </div>
                    <div class="flex items-center gap-2 bg-gray-900 px-4 py-2 rounded-lg">
                        <span class="text-neon-green font-black text-xl">${set.weight}</span>
                        <span class="text-gray-600 text-sm font-bold">kg</span>
                        <span class="text-gray-700 mx-1">×</span>
                        <span class="text-white font-black text-xl">${set.reps}</span>
                    </div>
                </div>
            `).join('');
        }

        // Check if suggestion should be shown
        function checkSuggestion() {
            const exercise = document.getElementById('exercise').value.trim();
            const reps = parseInt(document.getElementById('reps').value);
            const suggestionBox = document.getElementById('suggestionBox');
            const suggestionText = document.getElementById('suggestionText');
            
            if (exercise && reps >= 5) {
                const lastSet = getLastSetForExercise(exercise);
                if (lastSet && lastSet.reps >= 5) {
                    const suggested = (lastSet.weight + 2.5).toFixed(1);
                    suggestionText.textContent = `Sugestia: +2.5kg (${suggested}kg)`;
                    suggestionBox.classList.remove('hidden');
                } else {
                    suggestionBox.classList.add('hidden');
                }
            } else {
                suggestionBox.classList.add('hidden');
            }
        }

        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const exercise = document.getElementById('exercise').value.trim();
            const weight = parseFloat(document.getElementById('weight').value);
            const reps = parseInt(document.getElementById('reps').value);
            
            if (!exercise || !weight || !reps) return;
            
            // Create new set
            const newSet = {
                id: crypto.randomUUID(),
                exercise: exercise,
                weight: weight,
                reps: reps,
                timestamp: Date.now()
            };
            
            // Save to localStorage
            const sets = loadSets();
            sets.unshift(newSet);
            saveSets(sets);
            
            // Show toast
            const toast = document.getElementById('toast');
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 2000);
            
            // Update UI
            displayRecentSets();
            loadExerciseHistory();
            
            // Reset form
            e.target.reset();
            document.getElementById('suggestionBox').classList.add('hidden');
            document.getElementById('exercise').focus();
        }
    </script>
</body>
</html>
