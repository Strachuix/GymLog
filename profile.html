<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121212">
    <link rel="icon" type="image/png" sizes="64x64" href="assets/logo-small-64.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/logo-small-256.png">
    <link rel="manifest" href="manifest.json">
    <title>GymLog - Profil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neon-green': '#10b981',
                        'dark-bg': '#121212',
                        'dark-card': '#1e1e1e',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-dark-bg text-gray-100 min-h-screen pb-20">
    <div class="max-w-lg mx-auto p-4 sm:p-6">
        <!-- Header -->
        <header class="flex items-center justify-between mb-8 pt-4">
            <div class="flex items-center gap-3">
                <img src="assets/logo.png" alt="GymLog" class="h-10 w-auto">
                <h1 class="text-2xl font-black text-neon-green">Profil</h1>
            </div>
        </header>

        <!-- Main Content -->
        <main class="space-y-6">
            <!-- Profile Card -->
            <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
                <div class="flex items-center gap-4 mb-6">
                    <div class="relative w-20 h-20 rounded-full group cursor-pointer" onclick="document.getElementById('profilePicInput').click()">
                        <img id="profilePicDisplay" src="" alt="Profile" class="hidden w-full h-full rounded-full object-cover border-2 border-neon-green">
                        <div id="profilePicPlaceholder" class="w-20 h-20 rounded-full bg-gradient-to-br from-neon-green to-green-600 flex items-center justify-center">
                            <svg class="w-12 h-12 text-gray-900" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                        </div>
                        <div class="absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <input type="file" id="profilePicInput" accept="image/*" class="hidden">
                    </div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-500">UÅ¼ytkownik</p>
                        <p id="displayUsername" class="text-xl font-bold text-gray-200">GymLog User</p>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-gray-900 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-500 mb-1">Wiek</p>
                        <p id="displayAge" class="text-lg font-bold text-neon-green">-</p>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-500 mb-1">Wzrost</p>
                        <p id="displayHeight" class="text-lg font-bold text-neon-green">-</p>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-500 mb-1">Waga</p>
                        <p id="displayWeight" class="text-lg font-bold text-neon-green">-</p>
                    </div>
                </div>
            </div>

            <!-- BMI Card -->
            <div id="bmiCard" class="hidden bg-dark-card rounded-xl p-6 border border-gray-800 animate-slide-in">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    <h2 class="text-xl font-black text-gray-300">BMI</h2>
                </div>
                <div class="flex items-center justify-between mb-3">
                    <span class="text-3xl font-black" id="bmiValue">-</span>
                    <span class="px-3 py-1 rounded-full text-sm font-bold" id="bmiCategory">-</span>
                </div>
                <div class="h-2 bg-gray-900 rounded-full overflow-hidden">
                    <div id="bmiBar" class="h-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <div class="mt-3 flex justify-between text-xs text-gray-500">
                    <span>Niedowaga</span>
                    <span>Norma</span>
                    <span>Nadwaga</span>
                </div>
            </div>

            <!-- Edit Profile Form -->
            <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
                <h3 class="text-lg font-bold text-gray-300 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-neon-green" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Edytuj dane
                </h3>
                <form id="profileForm" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-semibold text-gray-400 mb-2">Nazwa uÅ¼ytkownika</label>
                        <input type="text" id="username" maxlength="30" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-gray-100 focus:outline-none focus:ring-2 focus:ring-neon-green focus:border-transparent transition-all" placeholder="np. Jan Kowalski">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-400 mb-2">PÅ‚eÄ‡</label>
                        <div class="flex gap-3">
                            <label class="flex-1 flex items-center justify-center gap-2 bg-gray-900 border-2 border-gray-700 rounded-lg p-3 cursor-pointer hover:border-neon-green transition-colors">
                                <input type="radio" name="gender" value="male" class="hidden peer">
                                <svg class="w-5 h-5 text-gray-500 peer-checked:text-neon-green" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 9c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3zm0 6c-3.31 0-10 1.67-10 5v2h20v-2c0-3.33-6.69-5-10-5z"/>
                                </svg>
                                <span class="text-sm font-bold text-gray-500 peer-checked:text-neon-green">MÄ™Å¼czyzna</span>
                            </label>
                            <label class="flex-1 flex items-center justify-center gap-2 bg-gray-900 border-2 border-gray-700 rounded-lg p-3 cursor-pointer hover:border-neon-green transition-colors">
                                <input type="radio" name="gender" value="female" class="hidden peer">
                                <svg class="w-5 h-5 text-gray-500 peer-checked:text-neon-green" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 9c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3zm0 6c-3.31 0-10 1.67-10 5v2h20v-2c0-3.33-6.69-5-10-5z"/>
                                </svg>
                                <span class="text-sm font-bold text-gray-500 peer-checked:text-neon-green">Kobieta</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label for="age" class="block text-sm font-semibold text-gray-400 mb-2">Wiek (lata)</label>
                        <input type="number" id="age" min="10" max="120" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-gray-100 focus:outline-none focus:ring-2 focus:ring-neon-green focus:border-transparent transition-all" placeholder="np. 25">
                    </div>
                    <div>
                        <label for="height" class="block text-sm font-semibold text-gray-400 mb-2">Wzrost (cm)</label>
                        <input type="number" id="height" min="100" max="250" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-gray-100 focus:outline-none focus:ring-2 focus:ring-neon-green focus:border-transparent transition-all" placeholder="np. 180">
                    </div>
                    <button type="submit" class="w-full bg-neon-green hover:bg-green-600 text-gray-900 font-black py-3 rounded-lg transition-colors">
                        Zapisz dane
                    </button>
                </form>
            </div>

            <!-- Add Weight Entry -->
            <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
                <h3 class="text-lg font-bold text-gray-300 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Dodaj pomiar wagi
                </h3>
                <form id="weightForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label for="weightDate" class="block text-sm font-semibold text-gray-400 mb-2">Data</label>
                            <input type="date" id="weightDate" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-gray-100 focus:outline-none focus:ring-2 focus:ring-neon-green focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label for="weight" class="block text-sm font-semibold text-gray-400 mb-2">Waga (kg)</label>
                            <input type="number" id="weight" step="0.1" min="30" max="300" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-gray-100 focus:outline-none focus:ring-2 focus:ring-neon-green focus:border-transparent transition-all" placeholder="np. 80">
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-black py-3 rounded-lg transition-colors">
                        Dodaj wpis
                    </button>
                </form>
            </div>

            <!-- Weight Chart -->
            <div id="weightChartContainer" class="hidden bg-dark-card rounded-xl p-6 border border-gray-800 animate-slide-in">
                <h3 class="text-lg font-bold text-gray-300 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                    </svg>
                    Historia wagi
                </h3>
                <div class="bg-gray-900 rounded-lg p-3 mb-4">
                    <canvas id="weightChart"></canvas>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-gray-900 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-500 mb-1">Zmiana</p>
                        <p id="weightChange" class="text-lg font-bold">-</p>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-500 mb-1">Åšrednia</p>
                        <p id="weightAverage" class="text-lg font-bold text-gray-300">-</p>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-500 mb-1">Pomiary</p>
                        <p id="weightCount" class="text-lg font-bold text-gray-300">-</p>
                    </div>
                </div>
            </div>

            <!-- Weight History List -->
            <div id="weightHistoryContainer" class="hidden bg-dark-card rounded-xl p-6 border border-gray-800 animate-slide-in">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-300">Ostatnie pomiary</h3>
                    <button id="clearWeightHistoryBtn" class="text-sm text-red-400 hover:text-red-300 font-semibold">WyczyÅ›Ä‡</button>
                </div>
                <div id="weightHistory" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- App Info -->
            <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wide">Informacje o aplikacji</h3>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500">Wersja</span>
                        <span class="text-sm font-bold text-gray-300" id="appVersion">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500">Ostatnia aktualizacja</span>
                        <span class="text-sm font-bold text-gray-300">3 lutego 2026</span>
                    </div>
                    <div class="pt-2 border-t border-gray-800 text-center">
                        <p class="text-xs text-gray-600">Made with ðŸ’ª for GymLog</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-dark-card border-t border-gray-800 z-50">
        <div class="max-w-lg mx-auto flex">
            <a href="index.html" class="flex-1 flex flex-col items-center justify-center py-4 text-gray-500 hover:text-gray-400 transition-colors">
                <img src="assets/dumbbell-solid-full.svg" alt="Trening" class="w-7 h-7 mb-1" style="filter: brightness(0) saturate(100%) invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(95%) contrast(90%);">
                <span class="text-xs font-bold">TRENING</span>
            </a>
            <a href="stats.html" class="flex-1 flex flex-col items-center justify-center py-4 text-gray-500 hover:text-gray-400 transition-colors">
                <img src="assets/chart-simple-solid-full.svg" alt="Statystyki" class="w-7 h-7 mb-1" style="filter: brightness(0) saturate(100%) invert(35%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(95%) contrast(90%);">
                <span class="text-xs font-bold">STATYSTYKI</span>
            </a>
            <a href="profile.html" class="flex-1 flex flex-col items-center justify-center py-4 text-neon-green">
                <svg class="w-7 h-7 mb-1" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <span class="text-xs font-bold">PROFIL</span>
            </a>
        </div>
    </nav>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        const PROFILE_KEY = 'gymlog_profile';
        const WEIGHT_HISTORY_KEY = 'gymlog_weight_history';

        // Load profile data
        function loadProfile() {
            const data = localStorage.getItem(PROFILE_KEY);
            return data ? JSON.parse(data) : null;
        }

        // Save profile data
        function saveProfile(profile) {
            localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
        }

        // Load weight history
        function loadWeightHistory() {
            const data = localStorage.getItem(WEIGHT_HISTORY_KEY);
            return data ? JSON.parse(data) : [];
        }

        // Save weight history
        function saveWeightHistory(history) {
            localStorage.setItem(WEIGHT_HISTORY_KEY, JSON.stringify(history));
        }

        // Calculate BMI
        function calculateBMI(weight, height) {
            const heightInMeters = height / 100;
            return weight / (heightInMeters * heightInMeters);
        }

        // Get BMI category
        function getBMICategory(bmi) {
            if (bmi < 18.5) return { text: 'Niedowaga', color: 'bg-yellow-500', textColor: 'text-yellow-900' };
            if (bmi < 25) return { text: 'Norma', color: 'bg-green-500', textColor: 'text-green-900' };
            if (bmi < 30) return { text: 'Nadwaga', color: 'bg-orange-500', textColor: 'text-orange-900' };
            return { text: 'OtyÅ‚oÅ›Ä‡', color: 'bg-red-500', textColor: 'text-red-900' };
        }

        // Update display
        function updateDisplay() {
            const profile = loadProfile();
            const weightHistory = loadWeightHistory();

            if (profile) {
                // Display username
                document.getElementById('displayUsername').textContent = profile.username || 'GymLog User';
                
                // Display profile picture
                if (profile.profilePic) {
                    document.getElementById('profilePicDisplay').src = profile.profilePic;
                    document.getElementById('profilePicDisplay').classList.remove('hidden');
                    document.getElementById('profilePicPlaceholder').classList.add('hidden');
                } else {
                    document.getElementById('profilePicDisplay').classList.add('hidden');
                    document.getElementById('profilePicPlaceholder').classList.remove('hidden');
                }
                
                document.getElementById('displayAge').textContent = profile.age || '-';
                document.getElementById('displayHeight').textContent = profile.height ? `${profile.height} cm` : '-';
                
                // Set form values
                document.getElementById('username').value = profile.username || '';
                if (profile.gender) {
                    document.querySelector(`input[name="gender"][value="${profile.gender}"]`).checked = true;
                }
                document.getElementById('age').value = profile.age || '';
                document.getElementById('height').value = profile.height || '';

                // Get latest weight
                const latestWeight = weightHistory.length > 0 ? weightHistory[0].weight : null;
                document.getElementById('displayWeight').textContent = latestWeight ? `${latestWeight} kg` : '-';

                // Calculate and display BMI
                if (profile.height && latestWeight) {
                    const bmi = calculateBMI(latestWeight, profile.height);
                    const category = getBMICategory(bmi);
                    
                    document.getElementById('bmiValue').textContent = bmi.toFixed(1);
                    const categoryEl = document.getElementById('bmiCategory');
                    categoryEl.textContent = category.text;
                    categoryEl.className = `px-3 py-1 rounded-full text-sm font-bold ${category.color} ${category.textColor}`;
                    
                    const bmiBar = document.getElementById('bmiBar');
                    const percentage = Math.min((bmi / 40) * 100, 100);
                    bmiBar.style.width = `${percentage}%`;
                    bmiBar.className = `h-full transition-all duration-500 ${category.color}`;
                    
                    document.getElementById('bmiCard').classList.remove('hidden');
                } else {
                    document.getElementById('bmiCard').classList.add('hidden');
                }
            }

            // Update weight chart and history
            if (weightHistory.length > 0) {
                displayWeightChart(weightHistory);
                displayWeightHistory(weightHistory);
                document.getElementById('weightChartContainer').classList.remove('hidden');
                document.getElementById('weightHistoryContainer').classList.remove('hidden');
            } else {
                document.getElementById('weightChartContainer').classList.add('hidden');
                document.getElementById('weightHistoryContainer').classList.add('hidden');
            }
        }

        // Display weight chart
        function displayWeightChart(history) {
            const sortedHistory = history.slice().reverse(); // Oldest to newest
            const ctx = document.getElementById('weightChart');
            
            // Destroy existing chart if any
            if (window.weightChartInstance) {
                window.weightChartInstance.destroy();
            }

            window.weightChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedHistory.map(entry => {
                        const date = new Date(entry.timestamp);
                        return date.toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit' });
                    }),
                    datasets: [{
                        label: 'Waga (kg)',
                        data: sortedHistory.map(entry => entry.weight),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(30, 30, 30, 0.95)',
                            titleColor: '#8b5cf6',
                            bodyColor: '#fff',
                            borderColor: '#8b5cf6',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: (items) => {
                                    const index = items[0].dataIndex;
                                    const date = new Date(sortedHistory[index].timestamp);
                                    return date.toLocaleDateString('pl-PL');
                                },
                                label: (context) => {
                                    return `${context.parsed.y} kg`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(75, 85, 99, 0.3)' },
                            ticks: { color: '#6b7280', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(75, 85, 99, 0.3)' },
                            ticks: { 
                                color: '#8b5cf6', 
                                font: { size: 11, weight: 'bold' },
                                callback: (value) => value + ' kg'
                            }
                        }
                    }
                }
            });

            // Calculate statistics
            const weights = sortedHistory.map(e => e.weight);
            const firstWeight = weights[0];
            const lastWeight = weights[weights.length - 1];
            const change = lastWeight - firstWeight;
            const average = weights.reduce((sum, w) => sum + w, 0) / weights.length;

            const changeEl = document.getElementById('weightChange');
            changeEl.textContent = change >= 0 ? `+${change.toFixed(1)} kg` : `${change.toFixed(1)} kg`;
            changeEl.className = `text-lg font-bold ${change >= 0 ? 'text-red-400' : 'text-neon-green'}`;
            
            document.getElementById('weightAverage').textContent = `${average.toFixed(1)} kg`;
            document.getElementById('weightCount').textContent = weights.length;
        }

        // Display weight history list
        function displayWeightHistory(history) {
            const container = document.getElementById('weightHistory');
            container.innerHTML = history.map((entry, index) => {
                const date = new Date(entry.timestamp);
                return `
                    <div class="flex items-center justify-between bg-gray-900 rounded-lg p-3">
                        <div>
                            <p class="text-sm font-bold text-gray-200">${entry.weight} kg</p>
                            <p class="text-xs text-gray-500">${date.toLocaleDateString('pl-PL')}</p>
                        </div>
                        <button onclick="deleteWeightEntry(${index})" class="text-red-400 hover:text-red-300 p-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Delete weight entry - make it global
        window.deleteWeightEntry = function(index) {
            if (!confirm('Czy na pewno chcesz usunÄ…Ä‡ ten wpis?')) return;
            
            const history = loadWeightHistory();
            history.splice(index, 1);
            saveWeightHistory(history);
            updateDisplay();
        }

        // Clear all weight history
        document.getElementById('clearWeightHistoryBtn').addEventListener('click', () => {
            if (!confirm('Czy na pewno chcesz usunÄ…Ä‡ caÅ‚Ä… historiÄ™ wagi?')) return;
            
            saveWeightHistory([]);
            document.getElementById('weightChartContainer').classList.add('hidden');
            document.getElementById('weightHistoryContainer').classList.add('hidden');
            updateDisplay();
        });

        // Profile form submit
        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const gender = document.querySelector('input[name="gender"]:checked')?.value;
            const age = parseInt(document.getElementById('age').value);
            const height = parseInt(document.getElementById('height').value);

            if (!gender || !age || !height) {
                alert('WypeÅ‚nij wszystkie pola!');
                return;
            }

            const existingProfile = loadProfile() || {};
            const profile = { 
                username: username || 'GymLog User',
                profilePic: existingProfile.profilePic || null,
                gender, 
                age, 
                height 
            };
            saveProfile(profile);
            updateDisplay();
            alert('âœ… Dane zapisane!');
        });

        // Weight form submit
        document.getElementById('weightForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const weight = parseFloat(document.getElementById('weight').value);
            const date = document.getElementById('weightDate').value;

            if (!weight || !date) {
                alert('WypeÅ‚nij wszystkie pola!');
                return;
            }

            const history = loadWeightHistory();
            history.unshift({
                timestamp: new Date(date).toISOString(),
                weight: weight
            });
            
            saveWeightHistory(history);
            updateDisplay();
            
            // Reset form
            document.getElementById('weight').value = '';
            document.getElementById('weightDate').value = '';
            
            alert('âœ… Wpis dodany!');
        });

        // Set today's date as default
        document.getElementById('weightDate').valueAsDate = new Date();

        // Profile picture upload handler
        document.getElementById('profilePicInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const profile = loadProfile() || {};
                    profile.profilePic = event.target.result;
                    localStorage.setItem('gymlog_profile', JSON.stringify(profile));
                    updateDisplay();
                };
                reader.readAsDataURL(file);
            }
        });

        // Initialize
        updateDisplay();

        // Get version from Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => {
                    console.log('Service Worker registered');
                    // Get version
                    if (navigator.serviceWorker.controller) {
                        const messageChannel = new MessageChannel();
                        messageChannel.port1.onmessage = (event) => {
                            if (event.data.type === 'VERSION') {
                                document.getElementById('appVersion').textContent = `v${event.data.version}`;
                            }
                        };
                        navigator.serviceWorker.controller.postMessage(
                            { type: 'GET_VERSION' },
                            [messageChannel.port2]
                        );
                    }
                })
                .catch(err => console.log('Service Worker registration failed:', err));
        }
    </script>
</body>
</html>
